# TD.rom - Teradata SQL Reference

**CRITICAL**: Teradata SQL is NOT standard SQL. Always use Teradata-specific syntax.

---

## üö® Teradata SQL Syntax (Non-Negotiable)

### Row Limiting
‚ùå WRONG: SELECT * FROM table LIMIT 10;
‚úÖ CORRECT: SELECT TOP 10 * FROM table;

### Type Casting
‚ùå WRONG: column::INTEGER
‚úÖ CORRECT: CAST(column AS INTEGER)

### String Concatenation
‚ùå WRONG: CONCAT(first, ' ', last)
‚úÖ CORRECT: first || ' ' || last

### Date Arithmetic
‚ùå WRONG: date + INTERVAL 7 DAY
‚úÖ CORRECT: date + INTERVAL '7' DAY  -- Note: number in quotes!

### CTEs in VIEWs
‚ùå WRONG: CREATE VIEW v AS WITH cte AS (...) SELECT * FROM cte;
-- Error: Teradata does NOT support CTEs in VIEW definitions
‚úÖ CORRECT: CREATE VIEW v AS SELECT * FROM (subquery) AS derived;
-- CTEs work fine in stored procedures and standalone queries

---

## üîë QUALIFY Clause (Teradata-Specific)

QUALIFY filters window function results WITHOUT subqueries. UNIQUE to Teradata.

‚ùå SLOWER (standard SQL):
SELECT * FROM (
    SELECT *, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY date DESC) AS rn
    FROM orders
) WHERE rn = 1;

‚úÖ FASTER (Teradata QUALIFY):
SELECT * FROM orders
QUALIFY ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY date DESC) = 1;

Use for: ROW_NUMBER(), RANK(), DENSE_RANK(), COUNT() OVER(), SUM() OVER()

---

## ‚ö†Ô∏è Reserved Words (Cannot Use as Aliases)

| Reserved | Use Instead |
|----------|-------------|
| DATE | event_date, record_date |
| TIME | event_time, log_time |
| USER | username, user_id |
| VALUE | metric_value, data_value |
| LEVEL | tree_level, depth_level |
| COUNT | row_count, record_count |
| TIMESTAMP | event_ts, created_ts |
| INDEX | idx, position_idx |

‚ùå WRONG: SELECT USER AS USER FROM sessions;  -- Error 3707
‚úÖ CORRECT: SELECT USER AS username FROM sessions;

---

## üìä Table Types & Operations

| Type | Code | SELECT | INSERT | UPDATE | DELETE | Notes |
|------|------|--------|--------|--------|--------|-------|
| Table | T | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | Full DML |
| View | V | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | Read-only |
| Join Index | O | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | Pre-computed joins |
| Hash Index | H | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | Performance index |
| Global Temp | G | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | Session-scoped |
| Stored Procedure | P | ‚ùå | ‚ùå | ‚ùå | ‚ùå | Use CALL |
| Macro | M | ‚ùå | ‚ùå | ‚ùå | ‚ùå | Use EXEC |

Check table type before operations:
SELECT TableName, TableKind FROM DBC.TablesV WHERE DatabaseName = 'db' AND TableName = 'table';

---

## üîç DBC Metadata Views (Case-Sensitive!)

**CRITICAL**: Column names are case-sensitive. Always use exact casing.

DBC.DatabasesV    -- Database info (PermSpace, SpoolSpace)
DBC.TablesV       -- Table metadata (TableKind, CreateTimeStamp)
DBC.ColumnsV      -- Column definitions (ColumnType, Nullable)
DBC.IndicesV      -- Index information (IndexType, UniqueFlag)
DBC.AllRightsV    -- User permissions (AccessRight)
DBC.SessionInfoV  -- Active sessions (UserName, DefaultDatabase)
DBC.DBCInfoV      -- System info (VERSION, RELEASE)

Example:
SELECT DatabaseName, TableName, TableKind FROM DBC.TablesV WHERE DatabaseName = DATABASE;
-- Note: DatabaseName, TableName, TableKind (not lowercase)

---

## üö® Common Teradata Errors

| Error | Cause | Fix |
|-------|-------|-----|
| "Invalid syntax near LIMIT" | MySQL syntax | Use SELECT TOP n |
| "Syntax error near WITH" | CTE in VIEW | Use subquery/derived table |
| "Reserved keyword" (3707) | Used DATE/USER/VALUE | Use non-reserved alias |
| "Column not found" | Assumed column name | Check exact name in DBC.ColumnsV |

---

## üîß System Functions

USER           -- Current username
DATABASE       -- Current database
SESSION        -- Session ID
CURRENT_DATE   -- Today's date
CURRENT_TIMESTAMP  -- Current timestamp

---

## üìÖ Teradata Date/Time Functions

ADD_MONTHS(date, n)          -- Add months to date
MONTHS_BETWEEN(date1, date2) -- Difference in months
EXTRACT(YEAR FROM date)      -- Extract year/month/day
date + INTERVAL '7' DAY      -- Add days (note quotes)
date - INTERVAL '1' MONTH    -- Subtract months

---

## üî§ Teradata String Functions

string1 || string2           -- Concatenation
SUBSTR(string, start, len)   -- Substring (not SUBSTRING)
POSITION('x' IN string)      -- Find position
TRIM(string)                 -- Remove whitespace
INDEX(string, 'substring')   -- Find substring

---

## üí° Table Operations

REPLACE VIEW view_name AS ...     -- Not: CREATE OR REPLACE VIEW
REPLACE PROCEDURE proc AS ...     -- Not: CREATE OR REPLACE PROCEDURE
CREATE MULTISET TABLE ...         -- Allows duplicates (default)
CREATE SET TABLE ...              -- No duplicates

---

## Performance Tips (Teradata-Specific)

COLLECT STATISTICS ON table COLUMN (col);  -- After bulk loads
EXPLAIN SELECT ...;                         -- Check query plan
SELECT * FROM large_table SAMPLE 1000;      -- Sample for profiling
