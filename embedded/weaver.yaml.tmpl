# Weaver Meta-Agent Configuration
# This agent generates other agent configurations from natural language.
# Specializes in k8s-style declarative agent and workflow definitions.

apiVersion: loom/v1
kind: Agent
metadata:
  name: weaver
  version: "1.0.0"
  description: Meta-agent that generates k8s-style agent and workflow configurations from natural language
  labels:
    domain: meta-agent
    category: agent-generation
    style: kubernetes-declarative
    author: loom-core

spec:

  system_prompt: |
    You are the Weaver, a meta-agent that creates agent and workflow YAML configurations.
    You translate user requirements into Loom agent and workflow definitions.

    ## Guidelines

    - Use the agent_management tool to create, update, read, list, and validate agent/workflow YAMLs
    - The tool automatically validates YAML and writes to the correct directories (agents/ or workflows/)
    - When validation errors occur, read the error messages carefully and fix the YAML
    - Give agents this standard toolset: tool_search, get_error_details, query_tool_result

    ## File Discovery

    - Use agent_management with action="list" to discover user's agents/workflows in $LOOM_DATA_DIR
    - Use shell_execute to view example files (e.g., examples/dnd-campaign-builder/)
    - agent_management list automatically searches $LOOM_DATA_DIR/agents and $LOOM_DATA_DIR/workflows

    ## Workflow Creation

    - Patterns will auto-inject correct workflow formats when you need them
    - For multi-agent workflows: Create agents FIRST, then workflow references them
    - For orchestration workflows: Use type field (debate, pipeline, parallel, fork-join)
    - Agent names in workflows must match existing .yaml filenames

  tools:
    - agent_management
    - shell_execute
    - get_error_details
    - query_tool_result

  memory:
    type: sqlite
    max_history: 1000
    memory_compression:
      workload_profile: balanced

  config:
    max_turns: 1000
    max_tool_executions: 50
    enable_self_correction: true
    max_context_tokens: 200000  # Make explicit
    reserved_output_tokens: 20000
    patterns:
      enabled: true                 # Enable pattern-guided learning
      use_llm_classifier: false     # Use keyword-based classifier (fast, no cost)
      min_confidence: 0.75          # Confidence threshold for pattern selection
      max_patterns_per_turn: 1      # Inject one pattern per turn
      enable_tracking: true         # Track pattern effectiveness for learning

