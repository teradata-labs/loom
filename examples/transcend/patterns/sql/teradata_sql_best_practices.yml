# patterns/transcend/sql/teradata_sql_best_practices.yml
name: teradata_sql_best_practices
description: Core Teradata SQL syntax rules and best practices
library: transcend-sql
version: "1.0"

content: |
  # Teradata SQL Syntax Rules (CRITICAL)

  When generating Teradata SQL, you MUST follow these rules:

  ## Prohibited Syntax (NEVER USE)
  - ❌ NO CTEs (WITH clauses) in VIEW definitions - Teradata does not support this
  - ❌ NO LIMIT clause - use TOP N instead
  - ❌ NO PostgreSQL/MySQL/Oracle-specific syntax
  - ❌ NO reserved words as aliases: DATE, TIME, VALUE, USER, LEVEL

  ## Required Syntax (ALWAYS USE)
  - ✅ TOP N for result limiting (not LIMIT N)
  - ✅ TRIM() for string comparisons with padded fields
  - ✅ CAST(...) for type conversions
  - ✅ COALESCE(...) for NULL handling
  - ✅ QUALIFY clause for window function filtering (Teradata-specific)
  - ✅ '9999-12-31 23:59:59.999999' for current record filtering (SCD Type 2)

  ## Common Patterns

  ### Current Records Only (SCD Type 2)
  ```sql
  WHERE effective_end_date = '9999-12-31 23:59:59.999999'
  ```

  ### Status Code Filtering (with padding)
  ```sql
  WHERE TRIM(operational_status) = '1'  -- NOT '          1'
  ```

  ### Top N Results
  ```sql
  SELECT TOP 100 * FROM customer_health_score
  ORDER BY health_score ASC
  ```

  ### Window Functions with QUALIFY
  ```sql
  SELECT
    site_id,
    health_score,
    ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY health_score DESC) as rank
  FROM customer_health_score
  QUALIFY rank = 1  -- Teradata-specific: filter window function results
  ```

  ## Join Patterns

  ### Vantage Site Dimension (Most Common)
  ```sql
  FROM sites_daily_requests sdr
  JOIN vantage_sites vs ON sdr.site_id = vs.site_id
  WHERE vs.effective_end_date = '9999-12-31 23:59:59.999999'
  ```

  ### Daily Facts Join (Common Grain: site_id + log_dt)
  ```sql
  FROM sites_daily_requests sdr
  JOIN sites_daily_cpu_utilization cpu
    ON sdr.site_id = cpu.site_id
    AND sdr.log_dt = cpu.log_dt
  ```

  ## Performance Optimization
  - Filter on indexed columns first (site_id, log_dt)
  - Use COLLECT STATISTICS for large tables
  - Avoid SELECT * in production queries
  - Use PRIMARY INDEX hints when needed

tags:
  - teradata
  - sql
  - syntax
  - best-practices

variables: []
